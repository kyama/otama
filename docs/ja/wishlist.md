# otama に欲しいものリスト

やるか、できるか、分からない。できそうな順。

## 動画を扱えるようにする

クエリとフレームごとの類似度を計算することで動画内をリアルタイムに検索したり、動画をDBにインポートできたりするといい。
eiioでffmpegを使って動画のフレームを読み出せるようにして、それをotamaまでひっぱってくる。
別にotamaに組み込まなくてもいい気はするけど、ffmpegで直接やれとか言うのはかなり敷居が高い感じするので。

## 巨大なデータベースを分割して保持しているノード群を並列検索できるようにする

手動機能はすでにあるけど、かなり使いづらい。あまりテストもしてない。
とりあえず、すぐ試せるようなゲートウェイの例をexamplesに用意しておきたい。

リモートからshardを設定したりインデックスを消したりpullしたりできれば、
各ノードの割り当てを動的に制御するマネージャーが書けるので
大規模なクラスタをらくらく管理できるけど、個人的には一生使いそうにない機能なので、
欲しい人がいればこのページの一番下を見てください。

## VLADでの類似度を閾値でフィルタできるドライバ

idドライバはデータベースに正解がないときに意味不明な画像が出ることがあるので、VLADでの類似度を閾値でフィルタできるいい。
検索のたびにVLADを計算するのは負荷が大きいのでinsertの時点でVLADのベクトルを関連付けて保存しておきたい。
だたデータベースが超でかくなる。可逆でどれくらい圧縮できるか。

VLAD自体で直接検索できる方がいいけど、検索インデックスどうするかといった別の問題があるから、この方法のほうがすぐ出来そう。

## 実数ベクトルの近傍探索ライブラリ

結局のところこれがいるのだと思う。密でも検索できるやつ。

1. BoVWなんかは一番似ているもの（正解）でも、コサイン類似度が0.1以下だったりして、あまり似ていないけれど、それが検索できなければならない。
2. 0件から始まってデータが少しづつ増え続けやがて100万件になるような状況下でどの時点でも常に検索できなければならない。

1は、厳しい条件なので、正解が近くなるような特徴量を設計する方に力を入れるべきなのかもしれないけど、それもまた難しい感じする。2はデータが追加されるたびにツリーの再構築やクラスタリングなど再計算が必要なものは使えないって意味だけど、めちゃくちゃ速ければそれでもいい。なんらかの統計量が必要な場合は、予め超大量の画像から計算しておけば、使いまわせるようなものであればそうしたい。今でもBoVWのコードブックなんかはそういう感じだし。

## 類似尺度を学習できるドライバ

教師ありでどの画像とどの画像が似ているかを学習してその尺度で類似検索ができるといい。
アニメ顔類似検索でやっていたのがこういうやつなので、アニメ顔類似検索がいい感じになるように作ればよい。

Metric Learningとか研究分野があるらしい。あと検索のほうでやってるランキング学習とかも順序を学習しているから、正解データが上に来るように学習すればいいので、こっちのほうが直接的でいいかもしれないけれど、先にある程度絞れないとまたインデックスの問題になるから、結局先に類似尺度がいる感じする（全文検索場合は単語クエリに一致しているもので絞れている）。

## 物体検出した結果で登録/検索できるドライバ

入力された画像からアニメ顔検出をして各顔を登録したり、検索できたり。
前景を抽出してから登録したり、検索できたり。
画像と特徴抽出の間に1レイヤはさめるといい。
1枚の画像から複数の領域が取れる場合があるのでちょっと面倒な気もする。
検索ではどれを使うか選んでもらうためのUIとそのためのAPIがいる。

## 2000万ドル

ほしいでしゅ
